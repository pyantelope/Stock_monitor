{% extends "base.html" %}

{% block title %}Dashboard - {{ business_name }}{% endblock %}

{% block content %}
<h2 class="text-primary mb-4"> Welcome to {{ business_name }} Dashboard</h2>

<!-- Add Product Form -->
<div class="card p-4 mb-4 shadow-sm">
    <h4 class="text-success"> Add New Product</h4>
    <form method="POST" action="{{ url_for('add_product') }}">
        <div class="row g-3">
            <div class="col-md-3">
                <input type="text" name="name" placeholder="Product Name" class="form-control" required>
            </div>
            <div class="col-md-2">
                <input type="number" name="quantity" placeholder="Quantity" class="form-control" required>
            </div>
            <div class="col-md-2">
                <input type="number" name="threshold" placeholder="Threshold" class="form-control" required>
            </div>
            <div class="col-md-3">
                <input type="number" step="0.01" name="price" placeholder="Unit Price (â‚¦)" class="form-control" required>
            </div>
            <div class="col-md-2 d-grid">
                <button type="submit" class="btn btn-success">Add Product</button>
            </div>
        </div>
    </form>
</div>

<!-- Sales Button -->
<div class="mb-4">
    <a href="{{ url_for('record_sales') }}" class="btn btn-primary">ðŸ›’ Record Sales</a>
</div>

<!-- Product Table -->
{% if products %}
<table class="table table-bordered table-striped bg-white shadow-sm">
    <thead class="table-dark">
        <tr>
            <th>Name</th>
            <th>Initial Qty</th>
            <th>Sold</th>
            <th>In Stock</th>
            <th>Threshold</th>
            <th>Status</th>
            <th>Added</th>
            <th class="text-center">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for product in products %}
        <tr>
            <td>{{ product.name }}</td>
            <td>{{ product.initial_quantity }}</td>
            <td>{{ product.total_sold }}</td>
            <td>{{ product.current_stock }}</td>
            <td>{{ product.threshold }}</td>
            <td>
                {% if product.low_stock %}
                    <span class="badge bg-danger">Low</span>
                {% else %}
                    <span class="badge bg-success">OK</span>
                {% endif %}
            </td>
            <td>{{ product.created_at.strftime('%Y-%m-%d') }}</td>
            <td class="text-center">
                <!-- Restock -->
                <form action="{{ url_for('restock_product', product_id=product.id) }}" method="POST" class="d-inline">
                    <input type="number" name="restock_quantity" min="1" placeholder="Qty" class="form-control d-inline" style="width: 80px; display: inline-block;" required>
                    <button type="submit" class="btn btn-sm btn-warning">Restock</button>
                </form>
                <!-- Edit -->
                <a href="{{ url_for('edit_product', product_id=product.id) }}" class="btn btn-sm btn-info">Edit</a>
                <!-- Delete -->
                <form action="{{ url_for('delete_product', product_id=product.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Delete {{ product.name }}?');">
                    <button type="submit" class="btn btn-sm btn-danger">ðŸ—‘</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
    <div class="alert alert-info">No products added yet. Use the form above to get started.</div>
{% endif %}

{% endblock %}
